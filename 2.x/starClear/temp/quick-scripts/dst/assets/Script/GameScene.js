
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/GameScene.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'b71benT1ABC0aPZ2HVTgCte', 'GameScene');
// Script/GameScene.js

"use strict";

var GamePopStar = require("GamePopStar");

var GameData = require("GameData");

var GameTools = require("GameTools");

var GameUiTools = require("GameUiTools");

var GameConfig = require("GameConfig");

var AnimLayerTool = require("AnimLayerTool");

var GameScene = cc.Class({
  "extends": cc.Component,
  properties: {
    layerBack: cc.Sprite,
    backButton: cc.Node,
    //返回按钮
    cardNumberTTF: cc.Label,
    // 显示分数控件
    bestScoreTTF: cc.Label,
    // 显示最高分数控件
    progressBar: cc.Node,
    //进度条
    passNumTTF: cc.Label,
    //关数
    propMenu: [cc.Node],
    //道具按钮
    currentScore: 0,
    //当前得分
    isAddScore: false,
    //是否加分
    gameLogicLayer: cc.Node
  },
  ctor: function ctor() {
    GameConfig.GameScene = this;
    GameTools.playBackgroundMusic();
  },
  onLoad: function onLoad() {
    GameConfig.GameLogic = new GamePopStar();
    this.gameLogicLayer.addChild(GameConfig.GameLogic);
    this.currentScore = GameData.score0;
    this.cardNumberTTF.string = GameData.score0;
    this.bestScoreTTF.string = GameData.getGamePassScore();
    this.passNumTTF.string = "第 " + GameData.getGamePassNum() + " 关";
    GameUiTools.setButtonClickEvents(this, this.backButton, "backButtonFunc");
    GameUiTools.setButtonClickEvents(this, this.propMenu, "functionMenuTouchFunc");
  },
  start: function start() {},
  backButtonFunc: function backButtonFunc(event) {
    GameTools.playSimpleAudioEngine(0);
    this.loadingResource();
  },
  functionMenuTouchFunc: function functionMenuTouchFunc(event) {
    GameTools.playSimpleAudioEngine(0);
    var button = event.target;

    if (this.propMenu[0] == button) {
      if (GameData.getGamePropNumber(0) >= 1) {
        GameConfig.propsMenu = GameConfig.PropsMenu.PropsMenuDestroyCard;
      } else {
        this.showGamePropHelp(0);
        GameConfig.propsMenu = GameConfig.PropsMenu.PropsMenuSpace;
      }
    } else if (this.propMenu[1] == button) {
      if (GameData.getGamePropNumber(1) >= 1) {
        GameConfig.propsMenu = GameConfig.PropsMenu.PropsMenuRemoveAcross;
      } else {
        this.showGamePropHelp(1);
        GameConfig.propsMenu = GameConfig.PropsMenu.PropsMenuSpace;
      }
    } else if (this.propMenu[2] == button) {
      if (GameData.getGamePropNumber(2) >= 1) {
        GameConfig.propsMenu = GameConfig.PropsMenu.PropsMenuExchangeCard;
      } else {
        this.showGamePropHelp(2);
        GameConfig.propsMenu = GameConfig.PropsMenu.PropsMenuSpace;
      }
    } else {
      GameConfig.propsMenu = GameConfig.PropsMenu.PropsMenuSpace;
    }
  },
  showGamePropHelp: function showGamePropHelp(propType) {
    cc.loader.loadRes("panel/GamePropHelp", function (err, prefab) {
      var node = cc.instantiate(prefab);
      node.getComponent("GamePropHelp").setPropType(propType);
      cc.director.getScene().children[0].addChild(node);
    });
  },
  setGamePropNumber: function setGamePropNumber(propType) {
    console.log("00000000000000-------");
    this.propMenu[propType].getComponent("GamePropNode").setPropType();
  },
  setScore: function setScore(score) {
    if (this.currentScore > score) {
      this.currentScore = score;
      this.cardNumberTTF.string = this.currentScore;
    } else {
      this.isAddScore = true;
    }

    if (score > GameData.heightScore) {
      GameData.heightScore = score;
    }

    this.progressBar.scaleX = score / GameData.getGamePassScore() * 0.8;

    if (this.progressBar.scaleX > 0.9) {
      this.progressBar.scaleX = 0.9;
    }
  },
  update: function update(dt) {
    if (this.isAddScore && this.currentScore <= GameData.score0) {
      this.cardNumberTTF.string = this.currentScore++;
      this.currentScore++;
    } else {
      this.isAddScore = false;
    }
  },
  setPassNum: function setPassNum() {
    this.passNumTTF.string = "第 " + GameData.getGamePassNum() + " 关";
    this.bestScoreTTF.string = GameData.getGamePassScore();
  },
  loadingResource: function loadingResource() {
    GameTools.stopBackgroundMusic();
    GameConfig.loadingSceneType = GameConfig.LoadingSceneType.LoadingSceneBackGame;
    cc.director.loadScene("LoadingScene");
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxHYW1lU2NlbmUuanMiXSwibmFtZXMiOlsiR2FtZVBvcFN0YXIiLCJyZXF1aXJlIiwiR2FtZURhdGEiLCJHYW1lVG9vbHMiLCJHYW1lVWlUb29scyIsIkdhbWVDb25maWciLCJBbmltTGF5ZXJUb29sIiwiR2FtZVNjZW5lIiwiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJsYXllckJhY2siLCJTcHJpdGUiLCJiYWNrQnV0dG9uIiwiTm9kZSIsImNhcmROdW1iZXJUVEYiLCJMYWJlbCIsImJlc3RTY29yZVRURiIsInByb2dyZXNzQmFyIiwicGFzc051bVRURiIsInByb3BNZW51IiwiY3VycmVudFNjb3JlIiwiaXNBZGRTY29yZSIsImdhbWVMb2dpY0xheWVyIiwiY3RvciIsInBsYXlCYWNrZ3JvdW5kTXVzaWMiLCJvbkxvYWQiLCJHYW1lTG9naWMiLCJhZGRDaGlsZCIsInNjb3JlMCIsInN0cmluZyIsImdldEdhbWVQYXNzU2NvcmUiLCJnZXRHYW1lUGFzc051bSIsInNldEJ1dHRvbkNsaWNrRXZlbnRzIiwic3RhcnQiLCJiYWNrQnV0dG9uRnVuYyIsImV2ZW50IiwicGxheVNpbXBsZUF1ZGlvRW5naW5lIiwibG9hZGluZ1Jlc291cmNlIiwiZnVuY3Rpb25NZW51VG91Y2hGdW5jIiwiYnV0dG9uIiwidGFyZ2V0IiwiZ2V0R2FtZVByb3BOdW1iZXIiLCJwcm9wc01lbnUiLCJQcm9wc01lbnUiLCJQcm9wc01lbnVEZXN0cm95Q2FyZCIsInNob3dHYW1lUHJvcEhlbHAiLCJQcm9wc01lbnVTcGFjZSIsIlByb3BzTWVudVJlbW92ZUFjcm9zcyIsIlByb3BzTWVudUV4Y2hhbmdlQ2FyZCIsInByb3BUeXBlIiwibG9hZGVyIiwibG9hZFJlcyIsImVyciIsInByZWZhYiIsIm5vZGUiLCJpbnN0YW50aWF0ZSIsImdldENvbXBvbmVudCIsInNldFByb3BUeXBlIiwiZGlyZWN0b3IiLCJnZXRTY2VuZSIsImNoaWxkcmVuIiwic2V0R2FtZVByb3BOdW1iZXIiLCJjb25zb2xlIiwibG9nIiwic2V0U2NvcmUiLCJzY29yZSIsImhlaWdodFNjb3JlIiwic2NhbGVYIiwidXBkYXRlIiwiZHQiLCJzZXRQYXNzTnVtIiwic3RvcEJhY2tncm91bmRNdXNpYyIsImxvYWRpbmdTY2VuZVR5cGUiLCJMb2FkaW5nU2NlbmVUeXBlIiwiTG9hZGluZ1NjZW5lQmFja0dhbWUiLCJsb2FkU2NlbmUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBSUEsV0FBVyxHQUFHQyxPQUFPLENBQUMsYUFBRCxDQUF6Qjs7QUFDQSxJQUFJQyxRQUFRLEdBQUdELE9BQU8sQ0FBQyxVQUFELENBQXRCOztBQUNBLElBQUlFLFNBQVMsR0FBR0YsT0FBTyxDQUFDLFdBQUQsQ0FBdkI7O0FBQ0EsSUFBSUcsV0FBVyxHQUFHSCxPQUFPLENBQUMsYUFBRCxDQUF6Qjs7QUFDQSxJQUFJSSxVQUFVLEdBQUdKLE9BQU8sQ0FBQyxZQUFELENBQXhCOztBQUNBLElBQUlLLGFBQWEsR0FBR0wsT0FBTyxDQUFDLGVBQUQsQ0FBM0I7O0FBQ0EsSUFBSU0sU0FBUyxHQUFHQyxFQUFFLENBQUNDLEtBQUgsQ0FBUztFQUNyQixXQUFTRCxFQUFFLENBQUNFLFNBRFM7RUFFckJDLFVBQVUsRUFBRTtJQUNSQyxTQUFTLEVBQUVKLEVBQUUsQ0FBQ0ssTUFETjtJQUVSQyxVQUFVLEVBQUVOLEVBQUUsQ0FBQ08sSUFGUDtJQUVhO0lBQ3JCQyxhQUFhLEVBQUVSLEVBQUUsQ0FBQ1MsS0FIVjtJQUdnQjtJQUN4QkMsWUFBWSxFQUFFVixFQUFFLENBQUNTLEtBSlQ7SUFJZTtJQUN2QkUsV0FBVyxFQUFFWCxFQUFFLENBQUNPLElBTFI7SUFLYTtJQUNyQkssVUFBVSxFQUFFWixFQUFFLENBQUNTLEtBTlA7SUFNYTtJQUNyQkksUUFBUSxFQUFFLENBQUNiLEVBQUUsQ0FBQ08sSUFBSixDQVBGO0lBT1k7SUFFcEJPLFlBQVksRUFBRSxDQVROO0lBU1E7SUFDaEJDLFVBQVUs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QUwsQ0FBaUJrRCxNQUFqQixHQUEwQkYsS0FBSyxHQUFJakUsUUFBUSxDQUFDOEIsZ0JBQVQsRUFBVCxHQUF3QyxHQUFsRTs7SUFDQSxJQUFJLEtBQUtiLFdBQUwsQ0FBaUJrRCxNQUFqQixHQUEwQixHQUE5QixFQUFtQztNQUMvQixLQUFLbEQsV0FBTCxDQUFpQmtELE1BQWpCLEdBQTBCLEdBQTFCO0lBQ0g7RUFDSixDQTNGb0I7RUE0RnJCQyxNQUFNLEVBQUUsZ0JBQVVDLEVBQVYsRUFBYztJQUNsQixJQUFJLEtBQUtoRCxVQUFMLElBQW1CLEtBQUtELFlBQUwsSUFBcUJwQixRQUFRLENBQUM0QixNQUFyRCxFQUE2RDtNQUN6RCxLQUFLZCxhQUFMLENBQW1CZSxNQUFuQixHQUE0QixLQUFLVCxZQUFMLEVBQTVCO01BQ0EsS0FBS0EsWUFBTDtJQUNILENBSEQsTUFHTztNQUNILEtBQUtDLFVBQUwsR0FBa0IsS0FBbEI7SUFDSDtFQUNKLENBbkdvQjtFQW9HckJpRCxVQXBHcUIsd0JBb0dSO0lBQ1QsS0FBS3BELFVBQUwsQ0FBZ0JXLE1BQWhCLEdBQXlCLE9BQU83QixRQUFRLENBQUMrQixjQUFULEVBQVAsR0FBbUMsSUFBNUQ7SUFDQSxLQUFLZixZQUFMLENBQWtCYSxNQUFsQixHQUEyQjdCLFFBQVEsQ0FBQzhCLGdCQUFULEVBQTNCO0VBQ0gsQ0F2R29CO0VBd0dyQk8sZUFBZSxFQUFFLDJCQUFZO0lBQ3pCcEMsU0FBUyxDQUFDc0UsbUJBQVY7SUFDQXBFLFVBQVUsQ0FBQ3FFLGdCQUFYLEdBQThCckUsVUFBVSxDQUFDc0UsZ0JBQVgsQ0FBNEJDLG9CQUExRDtJQUNBcEUsRUFBRSxDQUFDb0QsUUFBSCxDQUFZaUIsU0FBWixDQUFzQixjQUF0QjtFQUNIO0FBNUdvQixDQUFULENBQWhCIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgR2FtZVBvcFN0YXIgPSByZXF1aXJlKFwiR2FtZVBvcFN0YXJcIik7XG52YXIgR2FtZURhdGEgPSByZXF1aXJlKFwiR2FtZURhdGFcIik7XG52YXIgR2FtZVRvb2xzID0gcmVxdWlyZShcIkdhbWVUb29sc1wiKTtcbnZhciBHYW1lVWlUb29scyA9IHJlcXVpcmUoXCJHYW1lVWlUb29sc1wiKTtcbnZhciBHYW1lQ29uZmlnID0gcmVxdWlyZShcIkdhbWVDb25maWdcIik7XG52YXIgQW5pbUxheWVyVG9vbCA9IHJlcXVpcmUoXCJBbmltTGF5ZXJUb29sXCIpO1xudmFyIEdhbWVTY2VuZSA9IGNjLkNsYXNzKHtcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXG4gICAgcHJvcGVydGllczoge1xuICAgICAgICBsYXllckJhY2s6IGNjLlNwcml0ZSxcbiAgICAgICAgYmFja0J1dHRvbjogY2MuTm9kZSwgLy/ov5Tlm57mjInpkq5cbiAgICAgICAgY2FyZE51bWJlclRURjogY2MuTGFiZWwsLy8g5pi+56S65YiG5pWw5o6n5Lu2XG4gICAgICAgIGJlc3RTY29yZVRURjogY2MuTGFiZWwsLy8g5pi+56S65pyA6auY5YiG5pWw5o6n5Lu2XG4gICAgICAgIHByb2dyZXNzQmFyOiBjYy5Ob2RlLC8v6L+b5bqm5p2hXG4gICAgICAgIHBhc3NOdW1UVEY6IGNjLkxhYmVsLC8v5YWz5pWwXG4gICAgICAgIHByb3BNZW51OiBbY2MuTm9kZV0sLy/pgZPlhbfmjInpkq5cblxuICAgICAgICBjdXJyZW50U2NvcmU6IDAsLy/lvZPliY3lvpfliIZcbiAgICAgICAgaXNBZGRTY29yZTogZmFsc2UsLy/mmK/lkKbliqDliIZcblxuICAgICAgICBnYW1lTG9naWNMYXllcjogY2MuTm9kZSxcbiAgICB9LFxuICAgIGN0b3I6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgR2FtZUNvbmZpZy5HYW1lU2NlbmUgPSB0aGlzO1xuICAgICAgICBHYW1lVG9vbHMucGxheUJhY2tncm91bmRNdXNpYygpO1xuICAgIH0sXG4gICAgb25Mb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIEdhbWVDb25maWcuR2FtZUxvZ2ljID0gbmV3IEdhbWVQb3BTdGFyKCk7XG4gICAgICAgIHRoaXMuZ2FtZUxvZ2ljTGF5ZXIuYWRkQ2hpbGQoR2FtZUNvbmZpZy5HYW1lTG9naWMpO1xuXG4gICAgICAgIHRoaXMuY3VycmVudFNjb3JlID0gR2FtZURhdGEuc2NvcmUwO1xuICAgICAgICB0aGlzLmNhcmROdW1iZXJUVEYuc3RyaW5nID0gR2FtZURhdGEuc2NvcmUwO1xuICAgICAgICB0aGlzLmJlc3RTY29yZVRURi5zdHJpbmcgPSBHYW1lRGF0YS5nZXRHYW1lUGFzc1Njb3JlKCk7XG4gICAgICAgIHRoaXMucGFzc051bVRURi5zdHJpbmcgPSBcIuesrCBcIiArIEdhbWVEYXRhLmdldEdhbWVQYXNzTnVtKCkgKyBcIiDlhbNcIjtcbiAgICAgICAgR2FtZVVpVG9vbHMuc2V0QnV0dG9uQ2xpY2tFdmVudHModGhpcywgdGhpcy5iYWNrQnV0dG9uLCBcImJhY2tCdXR0b25GdW5jXCIpO1xuICAgICAgICBHYW1lVWlUb29scy5zZXRCdXR0b25DbGlja0V2ZW50cyh0aGlzLCB0aGlzLnByb3BNZW51LCBcImZ1bmN0aW9uTWVudVRvdWNoRnVuY1wiKTtcbiAgICB9LFxuICAgIHN0YXJ0KCkge1xuICAgIH0sXG4gICAgYmFja0J1dHRvbkZ1bmM6IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBHYW1lVG9vbHMucGxheVNpbXBsZUF1ZGlvRW5naW5lKDApO1xuICAgICAgICB0aGlzLmxvYWRpbmdSZXNvdXJjZSgpO1xuICAgIH0sXG4gICAgZnVuY3Rpb25NZW51VG91Y2hGdW5jOiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgR2FtZVRvb2xzLnBsYXlTaW1wbGVBdWRpb0VuZ2luZSgwKTtcbiAgICAgICAgbGV0IGJ1dHRvbiA9IGV2ZW50LnRhcmdldDtcbiAgICAgICAgaWYgKHRoaXMucHJvcE1lbnVbMF0gPT0gYnV0dG9uKSB7XG4gICAgICAgICAgICBpZiAoR2FtZURhdGEuZ2V0R2FtZVByb3BOdW1iZXIoMCkgPj0gMSkge1xuICAgICAgICAgICAgICAgIEdhbWVDb25maWcucHJvcHNNZW51ID0gR2FtZUNvbmZpZy5Qcm9wc01lbnUuUHJvcHNNZW51RGVzdHJveUNhcmQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc2hvd0dhbWVQcm9wSGVscCgwKTtcbiAgICAgICAgICAgICAgICBHYW1lQ29uZmlnLnByb3BzTWVudSA9IEdhbWVDb25maWcuUHJvcHNNZW51LlByb3BzTWVudVNwYWNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMucHJvcE1lbnVbMV0gPT0gYnV0dG9uKSB7XG4gICAgICAgICAgICBpZiAoR2FtZURhdGEuZ2V0R2FtZVByb3BOdW1iZXIoMSkgPj0gMSkge1xuICAgICAgICAgICAgICAgIEdhbWVDb25maWcucHJvcHNNZW51ID0gR2FtZUNvbmZpZy5Qcm9wc01lbnUuUHJvcHNNZW51UmVtb3ZlQWNyb3NzO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dHYW1lUHJvcEhlbHAoMSk7XG4gICAgICAgICAgICAgICAgR2FtZUNvbmZpZy5wcm9wc01lbnUgPSBHYW1lQ29uZmlnLlByb3BzTWVudS5Qcm9wc01lbnVTcGFjZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnByb3BNZW51WzJdID09IGJ1dHRvbikge1xuICAgICAgICAgICAgaWYgKEdhbWVEYXRhLmdldEdhbWVQcm9wTnVtYmVyKDIpID49IDEpIHtcbiAgICAgICAgICAgICAgICBHYW1lQ29uZmlnLnByb3BzTWVudSA9IEdhbWVDb25maWcuUHJvcHNNZW51LlByb3BzTWVudUV4Y2hhbmdlQ2FyZDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93R2FtZVByb3BIZWxwKDIpO1xuICAgICAgICAgICAgICAgIEdhbWVDb25maWcucHJvcHNNZW51ID0gR2FtZUNvbmZpZy5Qcm9wc01lbnUuUHJvcHNNZW51U3BhY2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBHYW1lQ29uZmlnLnByb3BzTWVudSA9IEdhbWVDb25maWcuUHJvcHNNZW51LlByb3BzTWVudVNwYWNlO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBzaG93R2FtZVByb3BIZWxwKHByb3BUeXBlKSB7XG4gICAgICAgIGNjLmxvYWRlci5sb2FkUmVzKFwicGFuZWwvR2FtZVByb3BIZWxwXCIsIChlcnIsIHByZWZhYikgPT4ge1xuICAgICAgICAgICAgbGV0IG5vZGUgPSBjYy5pbnN0YW50aWF0ZShwcmVmYWIpO1xuICAgICAgICAgICAgbm9kZS5nZXRDb21wb25lbnQoXCJHYW1lUHJvcEhlbHBcIikuc2V0UHJvcFR5cGUocHJvcFR5cGUpO1xuICAgICAgICAgICAgY2MuZGlyZWN0b3IuZ2V0U2NlbmUoKS5jaGlsZHJlblswXS5hZGRDaGlsZChub2RlKTtcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBzZXRHYW1lUHJvcE51bWJlcihwcm9wVHlwZSkge1xuXHRcdGNvbnNvbGUubG9nKFwiMDAwMDAwMDAwMDAwMDAtLS0tLS0tXCIpO1xuICAgICAgICB0aGlzLnByb3BNZW51W3Byb3BUeXBlXS5nZXRDb21wb25lbnQoXCJHYW1lUHJvcE5vZGVcIikuc2V0UHJvcFR5cGUoKTtcbiAgICB9LFxuICAgIHNldFNjb3JlOiBmdW5jdGlvbiAoc2NvcmUpIHtcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudFNjb3JlID4gc2NvcmUpIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFNjb3JlID0gc2NvcmU7XG4gICAgICAgICAgICB0aGlzLmNhcmROdW1iZXJUVEYuc3RyaW5nID0gdGhpcy5jdXJyZW50U2NvcmU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmlzQWRkU2NvcmUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzY29yZSA+IEdhbWVEYXRhLmhlaWdodFNjb3JlKSB7XG4gICAgICAgICAgICBHYW1lRGF0YS5oZWlnaHRTY29yZSA9IHNjb3JlO1xuXG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5wcm9ncmVzc0Jhci5zY2FsZVggPSBzY29yZSAvIChHYW1lRGF0YS5nZXRHYW1lUGFzc1Njb3JlKCkpICogMC44O1xuICAgICAgICBpZiAodGhpcy5wcm9ncmVzc0Jhci5zY2FsZVggPiAwLjkpIHtcbiAgICAgICAgICAgIHRoaXMucHJvZ3Jlc3NCYXIuc2NhbGVYID0gMC45O1xuICAgICAgICB9XG4gICAgfSxcbiAgICB1cGRhdGU6IGZ1bmN0aW9uIChkdCkge1xuICAgICAgICBpZiAodGhpcy5pc0FkZFNjb3JlICYmIHRoaXMuY3VycmVudFNjb3JlIDw9IEdhbWVEYXRhLnNjb3JlMCkge1xuICAgICAgICAgICAgdGhpcy5jYXJkTnVtYmVyVFRGLnN0cmluZyA9IHRoaXMuY3VycmVudFNjb3JlKys7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRTY29yZSsrO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5pc0FkZFNjb3JlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHNldFBhc3NOdW0oKSB7XG4gICAgICAgIHRoaXMucGFzc051bVRURi5zdHJpbmcgPSBcIuesrCBcIiArIEdhbWVEYXRhLmdldEdhbWVQYXNzTnVtKCkgKyBcIiDlhbNcIjtcbiAgICAgICAgdGhpcy5iZXN0U2NvcmVUVEYuc3RyaW5nID0gR2FtZURhdGEuZ2V0R2FtZVBhc3NTY29yZSgpO1xuICAgIH0sXG4gICAgbG9hZGluZ1Jlc291cmNlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIEdhbWVUb29scy5zdG9wQmFja2dyb3VuZE11c2ljKCk7XG4gICAgICAgIEdhbWVDb25maWcubG9hZGluZ1NjZW5lVHlwZSA9IEdhbWVDb25maWcuTG9hZGluZ1NjZW5lVHlwZS5Mb2FkaW5nU2NlbmVCYWNrR2FtZTtcbiAgICAgICAgY2MuZGlyZWN0b3IubG9hZFNjZW5lKFwiTG9hZGluZ1NjZW5lXCIpO1xuICAgIH0sXG59KTsiXX0=