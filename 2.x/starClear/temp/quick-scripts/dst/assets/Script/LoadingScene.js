
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/LoadingScene.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'fa66dpbqYROFqRT9GK3/WP2', 'LoadingScene');
// Script/LoadingScene.js

"use strict";

var GameData = require("GameData");

var GameTools = require("GameTools");

var GameUiTools = require("GameUiTools");

var GameConfig = require("GameConfig");

var AnimLayerTool = require("AnimLayerTool");

cc.Class({
  "extends": cc.Component,
  properties: {},
  start: function start() {
    var _this = this;

    setTimeout(function () {
      _this.loadingResource();
    }, 10);
  },
  loadingResource: function loadingResource() {
    if (GameConfig.loadingSceneType == GameConfig.LoadingSceneType.LoadingSceneFirst) {
      // GameTools.setGameIntegral(GameTools.getGameIntegral()+1000);
      GameConfig.IS_GAME_MUSIC = GameTools.getItemByLocalStorage("IS_GAME_MUSIC", true);
      this.initFrameCache();
      this.initWxSetting();
    } else if (GameConfig.loadingSceneType == GameConfig.LoadingSceneType.LoadingSceneEnterGame) {
      GameConfig.IS_GAME_OVER = false;
      GameData.initData();
      GameData.heightScore = GameData.getHeightScore();

      if (GameData.isHaveGameData()) {
        if (GameData.loadGameData(true) || GameData.heightScore < 0 || GameData.heightScore > 1073741824) {
          GameData.setHaveGameData(false);
          GameData.heightScore = 0;
          GameData.setHeightScore(0);
        }
      }
    } else if (GameConfig.loadingSceneType == GameConfig.LoadingSceneType.LoadingSceneBackGame) {
      if (!GameConfig.IS_GAME_OVER) {
        GameData.loadGameData(false);
      } // GameData.destroyInstance();

    }

    if (GameConfig.loadingSceneType == GameConfig.LoadingSceneType.LoadingSceneFirst) {
      cc.director.preloadScene("MenuUI", function () {
        cc.director.loadScene("MenuUI");
      });
    } else if (GameConfig.loadingSceneType == GameConfig.LoadingSceneType.LoadingSceneEnterGame) {
      cc.director.preloadScene("GameScene", function () {
        cc.director.loadScene("GameScene");
      });
    } else if (GameConfig.loadingSceneType == GameConfig.LoadingSceneType.LoadingSceneBackGame) {
      cc.director.preloadScene("MenuUI", function () {
        cc.director.loadScene("MenuUI");
      });
    }
  },
  initFrameCache: function initFrameCache() {
    cc.loader.loadRes("number", cc.LabelAtlas, function (err, atlas) {
      GameTools.numberLabelAtlas = atlas;
    });
  },
  initWxSetting: function initWxSetting() {
    if (CC_WECHATGAME) {
      window.wx.onHide(function () {
        //监听小游戏隐藏到后台事件
        if (GameConfig.loadingSceneType == GameConfig.LoadingSceneType.LoadingSceneEnterGame && !GameConfig.IS_GAME_OVER) {
          GameData.loadGameData(false);
          GameTools.stopBackgroundMusic();
        }
      });
      window.wx.onShow(function () {
        if (GameConfig.loadingSceneType == GameConfig.LoadingSceneType.LoadingSceneEnterGame && !GameConfig.IS_GAME_OVER) {
          if (GameConfig.IS_GAME_MUSIC) {
            GameTools.playBackgroundMusic();
          }
        }
      });
      window.wx.onAudioInterruptionBegin(function () {
        GameTools.stopBackgroundMusic();
      });
      window.wx.onAudioInterruptionEnd(function () {
        //监听音频中断结束
        if (GameConfig.loadingSceneType == GameConfig.LoadingSceneType.LoadingSceneEnterGame && !GameConfig.IS_GAME_OVER) {
          if (GameConfig.IS_GAME_MUSIC) {
            GameTools.playBackgroundMusic();
          }
        }
      });
      window.wx.showShareMenu({
        withShareTicket: true
      });
      window.wx.onShareAppMessage(function () {
        // 用户点击了“转发”按钮
        return {
          title: '来跟我一起挑战浪漫2048。',
          imageUrl: canvas.toTempFilePathSync({
            destWidth: 500,
            destHeight: 400
          })
        };
      });
      var LaunchOption = wx.getLaunchOptionsSync();

      if (LaunchOption.query != {} && LaunchOption.query.x != undefined) {
        GameConfig.MAIN_MENU_NUM = Number(LaunchOption.query.x);
      }

      var info = window.wx.getSystemInfoSync();
      GameConfig.GameClubButton = window.wx.createGameClubButton({
        icon: 'green',
        style: {
          left: info.windowWidth / 2 + 25,
          top: info.windowHeight * 90 / 100,
          width: 40,
          height: 40
        }
      });
      GameConfig.GameClubButton.hide();
    } else {// GameTools.getRankData("测试群排行");
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0XFxMb2FkaW5nU2NlbmUuanMiXSwibmFtZXMiOlsiR2FtZURhdGEiLCJyZXF1aXJlIiwiR2FtZVRvb2xzIiwiR2FtZVVpVG9vbHMiLCJHYW1lQ29uZmlnIiwiQW5pbUxheWVyVG9vbCIsImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwic3RhcnQiLCJzZXRUaW1lb3V0IiwibG9hZGluZ1Jlc291cmNlIiwibG9hZGluZ1NjZW5lVHlwZSIsIkxvYWRpbmdTY2VuZVR5cGUiLCJMb2FkaW5nU2NlbmVGaXJzdCIsIklTX0dBTUVfTVVTSUMiLCJnZXRJdGVtQnlMb2NhbFN0b3JhZ2UiLCJpbml0RnJhbWVDYWNoZSIsImluaXRXeFNldHRpbmciLCJMb2FkaW5nU2NlbmVFbnRlckdhbWUiLCJJU19HQU1FX09WRVIiLCJpbml0RGF0YSIsImhlaWdodFNjb3JlIiwiZ2V0SGVpZ2h0U2NvcmUiLCJpc0hhdmVHYW1lRGF0YSIsImxvYWRHYW1lRGF0YSIsInNldEhhdmVHYW1lRGF0YSIsInNldEhlaWdodFNjb3JlIiwiTG9hZGluZ1NjZW5lQmFja0dhbWUiLCJkaXJlY3RvciIsInByZWxvYWRTY2VuZSIsImxvYWRTY2VuZSIsImxvYWRlciIsImxvYWRSZXMiLCJMYWJlbEF0bGFzIiwiZXJyIiwiYXRsYXMiLCJudW1iZXJMYWJlbEF0bGFzIiwiQ0NfV0VDSEFUR0FNRSIsIndpbmRvdyIsInd4Iiwib25IaWRlIiwic3RvcEJhY2tncm91bmRNdXNpYyIsIm9uU2hvdyIsInBsYXlCYWNrZ3JvdW5kTXVzaWMiLCJvbkF1ZGlvSW50ZXJydXB0aW9uQmVnaW4iLCJvbkF1ZGlvSW50ZXJydXB0aW9uRW5kIiwic2hvd1NoYXJlTWVudSIsIndpdGhTaGFyZVRpY2tldCIsIm9uU2hhcmVBcHBNZXNzYWdlIiwidGl0bGUiLCJpbWFnZVVybCIsImNhbnZhcyIsInRvVGVtcEZpbGVQYXRoU3luYyIsImRlc3RXaWR0aCIsImRlc3RIZWlnaHQiLCJMYXVuY2hPcHRpb24iLCJnZXRMYXVuY2hPcHRpb25zU3luYyIsInF1ZXJ5IiwieCIsInVuZGVmaW5lZCIsIk1BSU5fTUVOVV9OVU0iLCJOdW1iZXIiLCJpbmZvIiwiZ2V0U3lzdGVtSW5mb1N5bmMiLCJHYW1lQ2x1YkJ1dHRvbiIsImNyZWF0ZUdhbWVDbHViQnV0dG9uIiwiaWNvbiIsInN0eWxlIiwibGVmdCIsIndpbmRvd1dpZHRoIiwidG9wIiwid2luZG93SGVpZ2h0Iiwid2lkdGgiLCJoZWlnaHQiLCJoaWRlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQUlBLFFBQVEsR0FBR0MsT0FBTyxDQUFDLFVBQUQsQ0FBdEI7O0FBQ0EsSUFBSUMsU0FBUyxHQUFHRCxPQUFPLENBQUMsV0FBRCxDQUF2Qjs7QUFDQSxJQUFJRSxXQUFXLEdBQUdGLE9BQU8sQ0FBQyxhQUFELENBQXpCOztBQUNBLElBQUlHLFVBQVUsR0FBR0gsT0FBTyxDQUFDLFlBQUQsQ0FBeEI7O0FBQ0EsSUFBSUksYUFBYSxHQUFHSixPQUFPLENBQUMsZUFBRCxDQUEzQjs7QUFDQUssRUFBRSxDQUFDQyxLQUFILENBQVM7RUFDTCxXQUFTRCxFQUFFLENBQUNFLFNBRFA7RUFFTEMsVUFBVSxFQUFFLEVBRlA7RUFJTEMsS0FKSyxtQkFJRztJQUFBOztJQUNKQyxVQUFVLENBQUMsWUFBTTtNQUNiLEtBQUksQ0FBQ0MsZUFBTDtJQUNILENBRlMsRUFFUCxFQUZPLENBQVY7RUFHSCxDQVJJO0VBVUxBLGVBVkssNkJBVWE7SUFDZCxJQUFJUixVQUFVLENBQUNTLGdCQUFYLElBQStCVCxVQUFVLENBQUNVLGdCQUFYLENBQTRCQyxpQkFBL0QsRUFBa0Y7TUFDOUU7TUFDQVgsVUFBVSxDQUFDWSxhQUFYLEdBQTJCZCxTQUFTLENBQUNlLHFCQUFWLENBQWdDLGVBQWhDLEVBQWlELElBQWpELENBQTNCO01BQ0EsS0FBS0MsY0FBTDtNQUNBLEtBQUtDLGFBQUw7SUFDSCxDQUxELE1BS08sSUFBSWYsVUFBVSxDQUFDUyxnQkFBWCxJ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RSxLQUFiLENBQW1CQyxDQUFwQixDQUFqQztNQUNIOztNQUNELElBQUlJLElBQUksR0FBR3hCLE1BQU0sQ0FBQ0MsRUFBUCxDQUFVd0IsaUJBQVYsRUFBWDtNQUNBN0QsVUFBVSxDQUFDOEQsY0FBWCxHQUE0QjFCLE1BQU0sQ0FBQ0MsRUFBUCxDQUFVMEIsb0JBQVYsQ0FBK0I7UUFDdkRDLElBQUksRUFBRSxPQURpRDtRQUV2REMsS0FBSyxFQUFFO1VBQ0hDLElBQUksRUFBRU4sSUFBSSxDQUFDTyxXQUFMLEdBQW1CLENBQW5CLEdBQXVCLEVBRDFCO1VBRUhDLEdBQUcsRUFBRVIsSUFBSSxDQUFDUyxZQUFMLEdBQW9CLEVBQXBCLEdBQXlCLEdBRjNCO1VBR0hDLEtBQUssRUFBRSxFQUhKO1VBSUhDLE1BQU0sRUFBRTtRQUpMO01BRmdELENBQS9CLENBQTVCO01BU0F2RSxVQUFVLENBQUM4RCxjQUFYLENBQTBCVSxJQUExQjtJQUNILENBbERELE1Ba0RPLENBQ0g7SUFDSDtFQUNKO0FBN0dJLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbInZhciBHYW1lRGF0YSA9IHJlcXVpcmUoXCJHYW1lRGF0YVwiKTtcbnZhciBHYW1lVG9vbHMgPSByZXF1aXJlKFwiR2FtZVRvb2xzXCIpO1xudmFyIEdhbWVVaVRvb2xzID0gcmVxdWlyZShcIkdhbWVVaVRvb2xzXCIpO1xudmFyIEdhbWVDb25maWcgPSByZXF1aXJlKFwiR2FtZUNvbmZpZ1wiKTtcbnZhciBBbmltTGF5ZXJUb29sID0gcmVxdWlyZShcIkFuaW1MYXllclRvb2xcIik7XG5jYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxuICAgIHByb3BlcnRpZXM6IHt9LFxuXG4gICAgc3RhcnQoKSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5sb2FkaW5nUmVzb3VyY2UoKTtcbiAgICAgICAgfSwgMTApO1xuICAgIH0sXG5cbiAgICBsb2FkaW5nUmVzb3VyY2UoKSB7XG4gICAgICAgIGlmIChHYW1lQ29uZmlnLmxvYWRpbmdTY2VuZVR5cGUgPT0gR2FtZUNvbmZpZy5Mb2FkaW5nU2NlbmVUeXBlLkxvYWRpbmdTY2VuZUZpcnN0KSB7XG4gICAgICAgICAgICAvLyBHYW1lVG9vbHMuc2V0R2FtZUludGVncmFsKEdhbWVUb29scy5nZXRHYW1lSW50ZWdyYWwoKSsxMDAwKTtcbiAgICAgICAgICAgIEdhbWVDb25maWcuSVNfR0FNRV9NVVNJQyA9IEdhbWVUb29scy5nZXRJdGVtQnlMb2NhbFN0b3JhZ2UoXCJJU19HQU1FX01VU0lDXCIsIHRydWUpO1xuICAgICAgICAgICAgdGhpcy5pbml0RnJhbWVDYWNoZSgpO1xuICAgICAgICAgICAgdGhpcy5pbml0V3hTZXR0aW5nKCk7XG4gICAgICAgIH0gZWxzZSBpZiAoR2FtZUNvbmZpZy5sb2FkaW5nU2NlbmVUeXBlID09IEdhbWVDb25maWcuTG9hZGluZ1NjZW5lVHlwZS5Mb2FkaW5nU2NlbmVFbnRlckdhbWUpIHtcbiAgICAgICAgICAgIEdhbWVDb25maWcuSVNfR0FNRV9PVkVSID0gZmFsc2U7XG4gICAgICAgICAgICBHYW1lRGF0YS5pbml0RGF0YSgpO1xuICAgICAgICAgICAgR2FtZURhdGEuaGVpZ2h0U2NvcmUgPSBHYW1lRGF0YS5nZXRIZWlnaHRTY29yZSgpO1xuICAgICAgICAgICAgaWYgKEdhbWVEYXRhLmlzSGF2ZUdhbWVEYXRhKCkpIHtcbiAgICAgICAgICAgICAgICBpZiAoR2FtZURhdGEubG9hZEdhbWVEYXRhKHRydWUpIHx8IEdhbWVEYXRhLmhlaWdodFNjb3JlIDwgMCB8fCBHYW1lRGF0YS5oZWlnaHRTY29yZSA+IDEwNzM3NDE4MjQpIHtcbiAgICAgICAgICAgICAgICAgICAgR2FtZURhdGEuc2V0SGF2ZUdhbWVEYXRhKGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgR2FtZURhdGEuaGVpZ2h0U2NvcmUgPSAwO1xuICAgICAgICAgICAgICAgICAgICBHYW1lRGF0YS5zZXRIZWlnaHRTY29yZSgwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoR2FtZUNvbmZpZy5sb2FkaW5nU2NlbmVUeXBlID09IEdhbWVDb25maWcuTG9hZGluZ1NjZW5lVHlwZS5Mb2FkaW5nU2NlbmVCYWNrR2FtZSkge1xuICAgICAgICAgICAgaWYoIUdhbWVDb25maWcuSVNfR0FNRV9PVkVSKXtcbiAgICAgICAgICAgICAgICBHYW1lRGF0YS5sb2FkR2FtZURhdGEoZmFsc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gR2FtZURhdGEuZGVzdHJveUluc3RhbmNlKCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoR2FtZUNvbmZpZy5sb2FkaW5nU2NlbmVUeXBlID09IEdhbWVDb25maWcuTG9hZGluZ1NjZW5lVHlwZS5Mb2FkaW5nU2NlbmVGaXJzdCkge1xuICAgICAgICAgICAgY2MuZGlyZWN0b3IucHJlbG9hZFNjZW5lKFwiTWVudVVJXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBjYy5kaXJlY3Rvci5sb2FkU2NlbmUoXCJNZW51VUlcIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChHYW1lQ29uZmlnLmxvYWRpbmdTY2VuZVR5cGUgPT0gR2FtZUNvbmZpZy5Mb2FkaW5nU2NlbmVUeXBlLkxvYWRpbmdTY2VuZUVudGVyR2FtZSkge1xuICAgICAgICAgICAgY2MuZGlyZWN0b3IucHJlbG9hZFNjZW5lKFwiR2FtZVNjZW5lXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBjYy5kaXJlY3Rvci5sb2FkU2NlbmUoXCJHYW1lU2NlbmVcIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChHYW1lQ29uZmlnLmxvYWRpbmdTY2VuZVR5cGUgPT0gR2FtZUNvbmZpZy5Mb2FkaW5nU2NlbmVUeXBlLkxvYWRpbmdTY2VuZUJhY2tHYW1lKSB7XG4gICAgICAgICAgICBjYy5kaXJlY3Rvci5wcmVsb2FkU2NlbmUoXCJNZW51VUlcIiwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGNjLmRpcmVjdG9yLmxvYWRTY2VuZShcIk1lbnVVSVwiKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBpbml0RnJhbWVDYWNoZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBjYy5sb2FkZXIubG9hZFJlcyhcIm51bWJlclwiLCBjYy5MYWJlbEF0bGFzLCBmdW5jdGlvbiAoZXJyLCBhdGxhcykge1xuICAgICAgICAgICAgR2FtZVRvb2xzLm51bWJlckxhYmVsQXRsYXMgPSBhdGxhcztcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBpbml0V3hTZXR0aW5nOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChDQ19XRUNIQVRHQU1FKSB7XG4gICAgICAgICAgICB3aW5kb3cud3gub25IaWRlKGZ1bmN0aW9uICgpIHsvL+ebkeWQrOWwj+a4uOaIj+makOiXj+WIsOWQjuWPsOS6i+S7tlxuICAgICAgICAgICAgICAgIGlmIChHYW1lQ29uZmlnLmxvYWRpbmdTY2VuZVR5cGUgPT0gR2FtZUNvbmZpZy5Mb2FkaW5nU2NlbmVUeXBlLkxvYWRpbmdTY2VuZUVudGVyR2FtZSAmJiAhR2FtZUNvbmZpZy5JU19HQU1FX09WRVIpIHtcbiAgICAgICAgICAgICAgICAgICAgR2FtZURhdGEubG9hZEdhbWVEYXRhKGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgR2FtZVRvb2xzLnN0b3BCYWNrZ3JvdW5kTXVzaWMoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHdpbmRvdy53eC5vblNob3coKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChHYW1lQ29uZmlnLmxvYWRpbmdTY2VuZVR5cGUgPT0gR2FtZUNvbmZpZy5Mb2FkaW5nU2NlbmVUeXBlLkxvYWRpbmdTY2VuZUVudGVyR2FtZSAmJiAhR2FtZUNvbmZpZy5JU19HQU1FX09WRVIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKEdhbWVDb25maWcuSVNfR0FNRV9NVVNJQykge1xuICAgICAgICAgICAgICAgICAgICAgICAgR2FtZVRvb2xzLnBsYXlCYWNrZ3JvdW5kTXVzaWMoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgd2luZG93Lnd4Lm9uQXVkaW9JbnRlcnJ1cHRpb25CZWdpbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgR2FtZVRvb2xzLnN0b3BCYWNrZ3JvdW5kTXVzaWMoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgd2luZG93Lnd4Lm9uQXVkaW9JbnRlcnJ1cHRpb25FbmQoKCkgPT4gey8v55uR5ZCs6Z+z6aKR5Lit5pat57uT5p2fXG4gICAgICAgICAgICAgICAgaWYgKEdhbWVDb25maWcubG9hZGluZ1NjZW5lVHlwZSA9PSBHYW1lQ29uZmlnLkxvYWRpbmdTY2VuZVR5cGUuTG9hZGluZ1NjZW5lRW50ZXJHYW1lICYmICFHYW1lQ29uZmlnLklTX0dBTUVfT1ZFUikge1xuICAgICAgICAgICAgICAgICAgICBpZiAoR2FtZUNvbmZpZy5JU19HQU1FX01VU0lDKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBHYW1lVG9vbHMucGxheUJhY2tncm91bmRNdXNpYygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB3aW5kb3cud3guc2hvd1NoYXJlTWVudSh7d2l0aFNoYXJlVGlja2V0OiB0cnVlfSk7XG4gICAgICAgICAgICB3aW5kb3cud3gub25TaGFyZUFwcE1lc3NhZ2UoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIC8vIOeUqOaIt+eCueWHu+S6huKAnOi9rOWPkeKAneaMiemSrlxuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiAn5p2l6Lef5oiR5LiA6LW35oyR5oiY5rWq5ryrMjA0OOOAgicsXG4gICAgICAgICAgICAgICAgICAgIGltYWdlVXJsOiBjYW52YXMudG9UZW1wRmlsZVBhdGhTeW5jKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc3RXaWR0aDogNTAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzdEhlaWdodDogNDAwXG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBsZXQgTGF1bmNoT3B0aW9uID0gd3guZ2V0TGF1bmNoT3B0aW9uc1N5bmMoKTtcbiAgICAgICAgICAgIGlmIChMYXVuY2hPcHRpb24ucXVlcnkgIT0ge30gJiYgTGF1bmNoT3B0aW9uLnF1ZXJ5LnggIT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgR2FtZUNvbmZpZy5NQUlOX01FTlVfTlVNID0gTnVtYmVyKExhdW5jaE9wdGlvbi5xdWVyeS54KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxldCBpbmZvID0gd2luZG93Lnd4LmdldFN5c3RlbUluZm9TeW5jKCk7XG4gICAgICAgICAgICBHYW1lQ29uZmlnLkdhbWVDbHViQnV0dG9uID0gd2luZG93Lnd4LmNyZWF0ZUdhbWVDbHViQnV0dG9uKHtcbiAgICAgICAgICAgICAgICBpY29uOiAnZ3JlZW4nLFxuICAgICAgICAgICAgICAgIHN0eWxlOiB7XG4gICAgICAgICAgICAgICAgICAgIGxlZnQ6IGluZm8ud2luZG93V2lkdGggLyAyICsgMjUsXG4gICAgICAgICAgICAgICAgICAgIHRvcDogaW5mby53aW5kb3dIZWlnaHQgKiA5MCAvIDEwMCxcbiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDQwLFxuICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDQwXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBHYW1lQ29uZmlnLkdhbWVDbHViQnV0dG9uLmhpZGUoKVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gR2FtZVRvb2xzLmdldFJhbmtEYXRhKFwi5rWL6K+V576k5o6S6KGMXCIpO1xuICAgICAgICB9XG4gICAgfSxcbn0pO1xuIl19